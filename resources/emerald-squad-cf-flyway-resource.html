<!DOCTYPE html>
<html lang="en">
<head>
    
    <title>Duty Free - CF Flyway Resource</title>

    <link rel="stylesheet" type="text/css" href="/dutyfree/static/style.css">
</head>
<body>
<div class="container">
    <div class="logo-area">
        <div class="title">
            <h1>CONCOURSE DUTY FREE</h1>
        </div>
    </div>


    <div class="search">
         
    </div>

    <nav class="sidebar">
         
    </nav>

    <main class="content">

        <div class="breadcrumb">
        
        
            
                    <span class="breadcrumb-link"><a href="/dutyfree">All Resources</a></span>
                
        
            
                    <span>CF Flyway Resource</span>
            
        
        </div>

        
    <section class="top-area">
        <h2>CF Flyway Resource</h2>
        <div>
            <a target="_blank" href="https://github.com/emerald-squad/cf-flyway-resource">
                <img src="/dutyfree/static/GitHub-Mark-120px-plus.png" alt="Resource Source on Github"
                     class="github-icon-detail"
                     title="Resource Source on Github">
            </a>
            <a href="https://github.com/emerald-squad" target="_blank" class="author">emerald-squad</a>
        </div>
    </section>
    <section class="middle-area">
        <div class="description">
            <h3>Description</h3>
            <p class="desc"></p>
        </div>
        
    </section>
    <section id="github-readme">
        <h3>Read Me</h3>
        <div id="readme" class="instapaper_body md" data-path="README.md"><article class="markdown-body entry-content p-5" itemprop="text"><h1><a id="user-content-cf-flyway-resource" class="anchor" aria-hidden="true" href="#cf-flyway-resource"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>cf-flyway-resource</h1>
<p>Version control for your database so you can migrate it with ease and confidence to Cloud Foundry database services with <a href="https://concourse-ci.org/" rel="nofollow">concourse-ci</a> and <a href="https://flywaydb.org/" rel="nofollow">Flyway</a>.</p>
<p>Features:</p>
<ul>
<li>Seamless connection to Cloud Foundry database services.</li>
<li>Support all flyway cli commands.</li>
<li>Support flyway configuration file.</li>
<li>Support Community and Pro Edition</li>
<li>Output database service metadata.</li>
</ul>
<h2><a id="user-content-supported-tags" class="anchor" aria-hidden="true" href="#supported-tags"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Supported Tags</h2>
<p>The following tags are officially supported:</p>
<p><a href="https://hub.docker.com/r/emeraldsquad/cf-flyway-resource/" rel="nofollow"><img src="https://camo.githubusercontent.com/eae89230ad75f7a579ffeb252225aa1aec864360/687474703a2f2f646f636b6572692e636f2f696d6167652f656d6572616c6473717561642f63662d666c797761792d7265736f75726365" alt="emeraldsquad/cf-flyway-resource" data-canonical-src="http://dockeri.co/image/emeraldsquad/cf-flyway-resource" style="max-width:100%;"></a></p>
<ul>
<li><a href="https://github.com/emerald-squad/cf-flyway-resource/blob/v1.0.1/Dockerfile"><code>1.0.1</code>, (<em>Dockerfile</em>)</a></li>
<li><a href="https://github.com/emerald-squad/cf-flyway-resource/blob/v1.0.0/Dockerfile"><code>1.0.0</code>, (<em>Dockerfile</em>)</a></li>
</ul>
<p><a href="https://hub.docker.com/r/jpmorin/cf-flyway-resource/" rel="nofollow"><img src="https://camo.githubusercontent.com/17023375effb302a351cd115cf1d85a0f20f1027/687474703a2f2f646f636b6572692e636f2f696d6167652f6a706d6f72696e2f63662d666c797761792d7265736f75726365" alt="jpmorin/cf-flyway-resource" data-canonical-src="http://dockeri.co/image/jpmorin/cf-flyway-resource" style="max-width:100%;"></a></p>
<ul>
<li><a href="https://github.com/emerald-squad/cf-flyway-resource/blob/v0.1.2/Dockerfile"><code>0.1.2</code>, (<em>Dockerfile</em>)</a></li>
<li><a href="https://github.com/emerald-squad/cf-flyway-resource/blob/v0.1.1/Dockerfile"><code>0.1.1</code>, (<em>Dockerfile</em>)</a></li>
</ul>
<h2><a id="user-content-resource_types" class="anchor" aria-hidden="true" href="#resource_types"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>resource_types</h2>
<p>The image <em>cf-flyway-resource</em> is built from <a href="https://hub.docker.com/r/boxfuse/flyway" rel="nofollow">boxfuse/flyway</a>. It also comes with the <code>cf_cli</code> and <code>jq</code> installed.</p>
<div class="highlight highlight-source-yaml"><pre>- <span class="pl-ent">name</span>: <span class="pl-s">cf-flyway-resource</span>
  <span class="pl-ent">type</span>: <span class="pl-s">docker-image</span>
  <span class="pl-ent">source</span>:
    <span class="pl-ent">repository</span>: <span class="pl-s">emeraldsquad/cf-flyway-resource</span>
    <span class="pl-ent">tag</span>: <span class="pl-s">1.0.0</span></pre></div>
<h2><a id="user-content-resource" class="anchor" aria-hidden="true" href="#resource"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>resource</h2>
<h3><a id="user-content-source" class="anchor" aria-hidden="true" href="#source"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>source</h3>
<ul>
<li><strong>api</strong> : <em>required</em> the api endpoint of the Cloud Foundry Cloud Controller</li>
<li><strong>username</strong>: <em>required</em> username to authenticate</li>
<li><strong>password</strong>: <em>required</em> password to authenticate</li>
<li><strong>organization</strong> : <em>required</em> the name of the organization to push to</li>
<li><strong>space</strong> : <em>required</em> the name of the space to push to</li>
<li><strong>service</strong> : <em>required</em> the name of the database service instance to push to</li>
</ul>
<div class="highlight highlight-source-yaml"><pre>- <span class="pl-ent">name</span>: <span class="pl-s">cf-flyway</span>
  <span class="pl-ent">type</span>: <span class="pl-s">cf-flyway-resource</span>
  <span class="pl-ent">source</span>:
    <span class="pl-ent">api</span>: <span class="pl-s">cf-api-endpoint</span>
    <span class="pl-ent">username</span>: <span class="pl-s">cf-user</span>
    <span class="pl-ent">password</span>: <span class="pl-s">cf-user-password</span>
    <span class="pl-ent">organization</span>: <span class="pl-s">organization-name</span>
    <span class="pl-ent">space</span>: <span class="pl-s">space-name</span>
    <span class="pl-ent">service</span>: <span class="pl-s">service-instance-name</span></pre></div>
<h2><a id="user-content-check" class="anchor" aria-hidden="true" href="#check"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>check</h2>
<h3><a id="user-content-version" class="anchor" aria-hidden="true" href="#version"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>version</h3>
<p>The <strong>check</strong> script always returns the current version number, or generate an initial version if none was received.</p>
<p>Version is expressed as datetime (utc).</p>
<h2><a id="user-content-in" class="anchor" aria-hidden="true" href="#in"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>in</h2>
<h3><a id="user-content-version-1" class="anchor" aria-hidden="true" href="#version-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>version</h3>
<p>The <strong>in</strong> script always returns the current version number. Therefore, the resources cannot be used as an input trigger.</p>
<h3><a id="user-content-metadata" class="anchor" aria-hidden="true" href="#metadata"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>metadata</h3>
<p>Read service information from the cf api to produce metadata.</p>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">metadata_url </span>: <span class="pl-s">/v2/service_instances/fe7f0258-5b6f-7b26-2cb2-79ad6f2a7454</span>
<span class="pl-ent">pcf_api </span>: <span class="pl-s">https://my.api.endpoint.com</span>
<span class="pl-ent">pcf_org </span>: <span class="pl-s">organization-name</span>
<span class="pl-ent">pcf_space </span>: <span class="pl-s">space-name</span>
<span class="pl-ent">service_instance </span>: <span class="pl-s">cf-db-service-instance-name</span>
<span class="pl-ent">service_label </span>: <span class="pl-s">cf-db-service-name</span>
<span class="pl-ent">service_plan </span>: <span class="pl-s">cf-db-service-plan</span></pre></div>
<h2><a id="user-content-out" class="anchor" aria-hidden="true" href="#out"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>out</h2>
<p>Migrate database schemas to CloudFoundry database service.</p>
<p>The <strong>out</strong> script creates a service-key on the Cloud Foundry database service. It then reads the credentials of the service-key and generate a <code>flyway.conf</code> file containing the CloudFoundry database service-key url, username and password.</p>
<p>The generated <code>flyway.conf</code> file will also have <code>flyway.cleanDisabled=true</code> set by default.</p>
<p>Any other flyway configuration provided by the user is also appended to the generated <code>flyway.conf</code> file. Note that the <strong>out</strong> script will always override the following config:</p>
<pre lang="conf"><code>flyway.url={service-key jdbc:driver//url/database}  # Overwritten by Cloud Foundry service-key credentials
flyway.user={service-key username}                  # Overwritten by Cloud Foundry service-key credentials
flyway.password={service-key password}              # Overwritten by Cloud Foundry service-key credentials
flyway.locations={params.locations}                 # Overwritten by locations parameter (required)
flyway.cleanDisabled=true                           # Overwritten by clean_disabled parameter (optional, default=true)
</code></pre>
<p>The <strong>out</strong> script then execute flyway commands. If a command list parameters is set, they will be executed sequentialy. If no command list parameters are set, the script defaults to the following commands.</p>
<ul>
<li><code>flyway info</code></li>
<li><code>flyway migrate</code></li>
<li><code>flyway info</code></li>
</ul>
<h3><a id="user-content-params" class="anchor" aria-hidden="true" href="#params"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>params</h3>
<ul>
<li><strong>locations</strong> <em>required</em>
<ul>
<li>Comma-separated list of locations to scan recursively for migrations.</li>
<li>The location type is determined by its prefix.</li>
<li>Unprefixed locations or locations starting with <code>classpath:</code> point to a package on the classpath and may contain both SQL and Java-based migrations.</li>
<li>Locations starting with <code>filesystem:</code> point to a directory on the filesystem, may only contain SQL migrations and are only scanned recursively down non-hidden directories.</li>
</ul>
</li>
<li><strong>commands</strong> <em>optional</em>
<ul>
<li>List of commands to execute. (default: <code>[info, migrate, info]</code>)</li>
<li>Available commands are:
<ul>
<li>migrate  : Migrates the database</li>
<li>clean    : Drops all objects in the configured schemas</li>
<li>info     : Prints the information about applied, current and pending migrations</li>
<li>validate : Validates the applied migrations against the ones on the classpath</li>
<li>undo     : [pro] Undoes the most recently applied versioned migration</li>
<li>baseline : Baselines an existing database at the baselineVersion</li>
<li>repair   : Repairs the schema history table</li>
</ul>
</li>
</ul>
</li>
<li><strong>clean_disabled</strong> <em>optional</em>
<ul>
<li>Whether to disabled clean. (default: <code>true</code>)</li>
<li>This is especially useful for production environments where running clean can be quite a career limiting move.</li>
</ul>
</li>
<li><strong>delete_service_key</strong> <em>optional</em>
<ul>
<li>Whether to delete the service-key on the Cloud Foundry database service when done. (default: <code>false</code>)</li>
<li>This is especially useful for on-demand qa environment.</li>
</ul>
</li>
<li><strong>flyway_conf</strong> <em>optional</em>
<ul>
<li>one of:
<ul>
<li>path to an existing flyway.conf file.</li>
<li>inline flyway configuration.</li>
</ul>
</li>
<li>The following configuration will be overwritten by the <strong>out</strong> script
<ul>
<li><code>flyway.url</code></li>
<li><code>flyway.user</code></li>
<li><code>flyway.password</code></li>
<li><code>flyway.locations</code></li>
<li><code>flyway.cleanDisabled</code></li>
</ul>
</li>
</ul>
</li>
<li><strong>jdbc_builder</strong> <em>optional</em> (beta)
<ul>
<li>Use this feature to connect to unrecognized database services.</li>
<li>one of:
<ul>
<li>path to an executable shell script.</li>
<li>inline shell script.</li>
</ul>
</li>
<li>Script receives the CloundFoundry service-key json credentials has positional parameter <code>$1</code>.</li>
<li>Script output CloundFoundry database jdbc url.</li>
</ul>
</li>
</ul>
<h4><a id="user-content-exemples" class="anchor" aria-hidden="true" href="#exemples"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exemples</h4>
<ol>
<li>Only use the required locations parameter.</li>
</ol>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">jobs</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">deploy</span>
  <span class="pl-ent">plan</span>:
  - <span class="pl-ent">get</span>: <span class="pl-s">my-app-package</span>
  - <span class="pl-ent">put</span>: <span class="pl-s">cf-flyway</span>
    <span class="pl-ent">params</span>:
      <span class="pl-ent">locations</span>: <span class="pl-s">filesystem:my-app-package/DB/Schema</span></pre></div>
<ol start="2">
<li>Add a flyway configuration file.</li>
</ol>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">jobs</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">deploy</span>
  <span class="pl-ent">plan</span>:
  - <span class="pl-ent">get</span>: <span class="pl-s">my-app-package</span>
  - <span class="pl-ent">put</span>: <span class="pl-s">cf-flyway</span>
    <span class="pl-ent">params</span>:
      <span class="pl-ent">locations</span>: <span class="pl-s">filesystem:my-app-package/DB/Schema</span>
      <span class="pl-ent">flyway_conf</span>: <span class="pl-s">my-app-package/DB/flyway.config</span></pre></div>
<ol start="3">
<li>Add inline flyway configuration.</li>
</ol>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">jobs</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">deploy</span>
  <span class="pl-ent">plan</span>:
  - <span class="pl-ent">get</span>: <span class="pl-s">my-app-package</span>
  - <span class="pl-ent">put</span>: <span class="pl-s">cf-flyway</span>
    <span class="pl-ent">params</span>:
      <span class="pl-ent">locations</span>: <span class="pl-s">filesystem:my-app-package/DB/Schema</span>
      <span class="pl-ent">flyway_conf</span>: <span class="pl-s">|</span>
<span class="pl-s">        flyway.schemas=dbo</span>
<span class="pl-s">        flyway.connectRetries=2</span></pre></div>
<ol start="4">
<li>Use a command sequence.</li>
</ol>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">jobs</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">deploy</span>
  <span class="pl-ent">plan</span>:
  - <span class="pl-ent">get</span>: <span class="pl-s">my-app-package</span>
  - <span class="pl-ent">put</span>: <span class="pl-s">cf-flyway</span>
    <span class="pl-ent">params</span>:
      <span class="pl-ent">locations</span>: <span class="pl-s">filesystem:my-app-package/DB/Schema</span>
      <span class="pl-ent">commands</span>: <span class="pl-s">[info, validate]</span></pre></div>
<ol start="5">
<li>Use Flyway <strong>Pro</strong> feature.</li>
</ol>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">jobs</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">deploy</span>
  <span class="pl-ent">plan</span>:
  - <span class="pl-ent">get</span>: <span class="pl-s">my-app-package</span>
  - <span class="pl-ent">put</span>: <span class="pl-s">cf-flyway</span>
    <span class="pl-ent">params</span>:
      <span class="pl-ent">locations</span>: <span class="pl-s">filesystem:my-app-package/DB/Schema</span>
      <span class="pl-ent">commands</span>: <span class="pl-s">[info, undo, info]</span>
      <span class="pl-ent">flyway_conf</span>: <span class="pl-s">|</span>
<span class="pl-s">        flyway.licenseKey=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</span></pre></div>
<ol start="6">
<li>Use jdbc_builder.</li>
</ol>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">jobs</span>:
- <span class="pl-ent">name</span>: <span class="pl-s">deploy</span>
  <span class="pl-ent">plan</span>:
  - <span class="pl-ent">get</span>: <span class="pl-s">my-app-package</span>
  - <span class="pl-ent">put</span>: <span class="pl-s">cf-flyway</span>
    <span class="pl-ent">params</span>:
      <span class="pl-ent">locations</span>: <span class="pl-s">filesystem:my-app-package/DB/Schema,</span>
      <span class="pl-ent">jdbc_builder</span>: <span class="pl-s">|</span>
<span class="pl-s">        echo jdbc:postgresql://$(echo $1 | jq -r '.uri' | grep -Poh '(?&lt;=@).*')</span></pre></div>
<h3><a id="user-content-version-2" class="anchor" aria-hidden="true" href="#version-2"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>version</h3>
<p>The <strong>out</strong> script always returns a new version number.</p>
<h3><a id="user-content-metadata-1" class="anchor" aria-hidden="true" href="#metadata-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>metadata</h3>
<p>Read service information from the cf api to produce metadata.</p>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">metadata_url </span>: <span class="pl-s">/v2/service_instances/fe7f0258-5b6f-7b26-2cb2-79ad6f2a7454</span>
<span class="pl-ent">pcf_api </span>: <span class="pl-s">https://my.api.endpoint.com</span>
<span class="pl-ent">pcf_org </span>: <span class="pl-s">organization-name</span>
<span class="pl-ent">pcf_space </span>: <span class="pl-s">space-name</span>
<span class="pl-ent">service_instance </span>: <span class="pl-s">cf-db-service-instance-name</span>
<span class="pl-ent">service_label </span>: <span class="pl-s">cf-db-service-name</span>
<span class="pl-ent">service_plan </span>: <span class="pl-s">cf-db-service-plan</span></pre></div>
</article></div>
    </section>


    </main>
</div>
    
</body>
</html>





